"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types")),reactFinalForm=require("react-final-form"),_isFunction=_interopDefault(require("lodash/isFunction")),classNames=_interopDefault(require("classnames")),Dropzone=_interopDefault(require("react-dropzone")),axios=_interopDefault(require("axios"));function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,o,a={},n=Object.keys(e);for(o=0;o<n.length;o++)r=n[o],0<=t.indexOf(r)||(a[r]=e[r]);return a}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var AppContext=React.createContext({}),ContextWrapper=function(o){function e(e,t){var r;return(r=o.call(this,e,t)||this).checkCondition=r.checkCondition.bind(_assertThisInitialized(r)),r.getStatus=r.getStatus.bind(_assertThisInitialized(r)),r.values={},r}_inheritsLoose(e,o);var t=e.prototype;return t.getStatus=function(){var e=this.props;return{dirty:e.dirty,dirtySinceLastSubmit:e.dirtySinceLastSubmit,error:e.error,errors:e.errors,invalid:e.invalid,pristine:e.pristine,submitError:e.submitError,submitErrors:e.submitErrors,submitFailed:e.submitFailed,submitSucceeded:e.submitSucceeded,submitting:e.submitting,valid:e.valid,validating:e.validating}},t.checkCondition=function(e){return e(this.props.values)},t.render=function(){var e=this.props,t=e.debug,r=e.children,o=e.listen;return t?React__default.createElement(AppContext.Provider,{value:{checkCondition:this.checkCondition,isStatic:this.props.static,debug:t,status:this.getStatus()}},r):React__default.createElement(AppContext.Provider,{value:{checkCondition:this.checkCondition,isStatic:this.props.static,debug:t,status:this.getStatus()}},r,o&&_isFunction(o)&&React__default.createElement(reactFinalForm.FormSpy,{subscription:{values:!0},onChange:function(e){o(e.values)}}))},e}(React__default.Component);ContextWrapper.propTypes={children:PropTypes.oneOfType([PropTypes.array,PropTypes.object]),static:PropTypes.bool,values:PropTypes.oneOfType([PropTypes.object]),debug:PropTypes.bool,dirty:PropTypes.bool,dirtySinceLastSubmit:PropTypes.bool,errors:PropTypes.oneOfType([PropTypes.object]),error:PropTypes.bool,invalid:PropTypes.bool,pristine:PropTypes.bool,submitError:PropTypes.bool,submitErrors:PropTypes.oneOfType([PropTypes.object]),submitFailed:PropTypes.bool,submitSucceeded:PropTypes.bool,submitting:PropTypes.bool,valid:PropTypes.bool,validating:PropTypes.bool,listen:PropTypes.func},ContextWrapper.defaultProps={static:!1,debug:!1};var Form=function(e){var o=e.children,a=e.className,n=e.debug,s=e.listen,t=_objectWithoutPropertiesLoose(e,["children","className","debug","listen"]);return React__default.createElement(reactFinalForm.Form,_extends({},t,{render:function(e){var t=e.handleSubmit,r=_objectWithoutPropertiesLoose(e,["handleSubmit"]);return React__default.createElement(ContextWrapper,_extends({},r,{debug:n,listen:s}),React__default.createElement("form",{onSubmit:t,className:a},o))}}))};function Context(s){function e(n){return React__default.createElement(AppContext.Consumer,null,function(a){return React__default.createElement(reactFinalForm.Field,{name:n.name,render:function(e){var t=e.input,r=e.meta,o=(t.type,_objectWithoutPropertiesLoose(t,["type"]));return React__default.createElement(s,_extends({input:o,meta:r,context:a},n))}})})}return e.propTypes={name:PropTypes.string.isRequired},e}function Context$1(P){function e(e){var t=e.label,r=e.name,o=e.text,a=e.disabled,n=e.formGroup,s=e.formLabel,i=e.formError,p=e.formText,l=e.context.checkCondition,u=e.meta,c=u.submitFailed,d=u.invalid,f=u.error,m=c&&d,y=a&&l(a),T=!m&&o&&React__default.createElement("div",{className:classNames("ffc-help",p)},o),h=m&&f&&React__default.createElement("div",{className:classNames("ffc-error",i)},f);return React__default.createElement("div",{className:classNames("ffc-field",{"text-danger":m},n)},t&&React__default.createElement("label",{htmlFor:r,className:classNames("ffc-label",s)},t),React__default.createElement(P,_extends({},e,{computedInvalid:m,isDisabled:y})),T,h)}return e.propTypes={name:PropTypes.string.isRequired,label:PropTypes.string,text:PropTypes.string,disabled:PropTypes.func,formGroup:PropTypes.string,formLabel:PropTypes.string,formError:PropTypes.string,formText:PropTypes.string,meta:PropTypes.shape({submitFailed:PropTypes.bool.isRequired,invalid:PropTypes.bool.isRequired,error:PropTypes.string}).isRequired,context:PropTypes.shape({checkCondition:PropTypes.func}).isRequired},e.defaultProps={label:null,text:null,formGroup:null,formLabel:null,formError:null,formText:null,disabled:null},e}Form.propTypes={className:PropTypes.string,validate:PropTypes.func,onSubmit:PropTypes.func.isRequired,children:PropTypes.oneOfType([PropTypes.object,PropTypes.array]).isRequired,debug:PropTypes.bool,listen:PropTypes.func,initialValues:PropTypes.objectOf(PropTypes.oneOfType([PropTypes.string,PropTypes.number,PropTypes.array,PropTypes.object]))},Form.defaultProps={className:"",validate:function(){},listen:function(){},debug:!1,initialValues:{}};var Checkbox=function(e){var a=e.input,n=e.isDisabled,s=e.multiple,t=e.children,r=e.formControl,o=e.computedInvalid,i=Array.isArray(t)?t:[t],p=i.map(function(t,e){var r=s?a.name+"["+e+"]":a.name,o=-1!==(Array.isArray(a.value)?a.value:[a.value]).filter(function(e){return String(e)}).indexOf(t.props.value);return React__default.createElement("div",{className:"form-check",key:t.props.value},React__default.createElement("input",{type:"checkbox",name:r,disabled:n,id:a.name+"_"+e,value:t.props.value,className:classNames("form-check-label"),checked:o,onChange:function(e){return function(e,t,r){if(s){var o=(a.value instanceof Array?a.value:[a.value]).filter(Boolean);return e.target.checked?o.push(r.props.value):o.splice(o.indexOf(r.props.value),1),a.onChange(o)}return a.onChange(!!e.target.checked&&r.props.value)}(e,0,t)}})," ",React__default.createElement("label",{htmlFor:a.name+"_"+e,className:classNames("form-check-label")},t.props.children))});return React__default.createElement("div",{className:classNames("ffc-input",{"is-invalid":o},r)},p)};Checkbox.propTypes={input:PropTypes.oneOfType([PropTypes.object]),children:PropTypes.oneOfType([PropTypes.object,PropTypes.array]).isRequired,formControl:PropTypes.string,multiple:PropTypes.bool,isDisabled:PropTypes.bool,computedInvalid:PropTypes.bool.isRequired},Checkbox.defaultProps={input:{},formControl:null,multiple:!1,isDisabled:!1};var Checkbox$1=Context(Context$1(Checkbox)),Condition=function(e){var t=e.context,r=e.children,o=e.hidden,a=e.visible;return o&&t.checkCondition(o)?null:a&&!t.checkCondition(a)?null:r};Condition.propTypes={children:PropTypes.oneOfType([PropTypes.array,PropTypes.object]).isRequired,context:PropTypes.shape({checkCondition:PropTypes.func}).isRequired,hidden:PropTypes.func,visible:PropTypes.func},Condition.defaultProps={hidden:null,visible:null};var Condition$1=function(t){return React__default.createElement(AppContext.Consumer,null,function(e){return React__default.createElement(Condition,_extends({context:e},t))})},FileUpload=function(a){function e(){for(var e,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return(e=a.call.apply(a,[this].concat(r))||this).progressElem=null,e.state={error:null},e}_inheritsLoose(e,a);var t=e.prototype;return t.componentDidMount=function(){var r=this,e=this.props,t=e.file,o=e.addOnStack,a=e.endPoint,n=0,s=new FormData;s.append("upload",t),axios.post(a.path,s,{headers:a.headers,onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);n=[t,"%"].join(""),r.progressElem.style.width=n,r.progressElem.innerHTML=100===t?"done":n}}).then(function(){o(t)}).catch(function(e){r.setState({error:e})})},t.render=function(){var t=this,e=this.props,r=e.file,o=e.removeFromStack;return this.state.error?React__default.createElement("tr",null,React__default.createElement("td",{colSpan:3},React__default.createElement("div",{className:"file-upload-error"},"There was an error, try again or contact the site owner."))):React__default.createElement("tr",null,React__default.createElement("td",{className:"file-upload-name"},r.preview&&React__default.createElement("img",{src:r.preview,alt:r.name,className:"img-thumbnail",style:{maxWidth:"80px"}})),React__default.createElement("td",{className:"file-upload-progress"},React__default.createElement("div",{className:"progress"},React__default.createElement("div",{ref:function(e){t.progressElem=e},className:"progress-bar",role:"progressbar",style:{width:"0%"},"aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"},"0%"))),React__default.createElement("td",{className:"file-upload-delete"},React__default.createElement("button",{className:"file-upload-delete-button",type:"button",onClick:function(){o(r)}},"x")))},e}(React__default.Component);FileUpload.propTypes={file:PropTypes.shape({name:PropTypes.string.isRequired,size:PropTypes.number.isRequired,preview:PropTypes.string.isRequired}).isRequired,endPoint:PropTypes.shape({path:PropTypes.string.isRequired,headers:PropTypes.shape({})}),removeFromStack:PropTypes.func.isRequired,addOnStack:PropTypes.func.isRequired},FileUpload.defaultProps={endPoint:{headers:{"Content-Type":"multipart/form-data"}}};var DropZone=function(o){function e(){for(var s,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(s=o.call.apply(o,[this].concat(t))||this).state={queue:[]},s.stack=[],s.filesFromClient=function(e){var t=s.state.queue,r=[].concat(t);e.forEach(function(e){e.preview=URL.createObjectURL(e),r.push(e)}),s.setState({queue:r})},s.addOnStack=function(e){var t=s.props.input,r=e.name,o=e.size,a=e.type,n=e.lastModified;s.stack.push({name:r,size:o,type:a,lastModified:n}),t.onChange(s.stack)},s.removeFromStack=function(t){var e=s.state.queue,r=s.props.input,o=e.filter(function(e){return e.name!==t.name}),a=s.stack.filter(function(e){return e.name!==t.name});s.stack=a,r.onChange(a),s.setState({queue:o})},s.displayFiles=function(){var e=s.state.queue,t=s.props.endPoint;if(0===e.length)return null;var r=e.map(function(e){return React__default.createElement(FileUpload,{key:e.name,file:e,addOnStack:s.addOnStack,removeFromStack:s.removeFromStack,endPoint:t})});return React__default.createElement("table",{className:"table"},React__default.createElement("tbody",null,r))},s}_inheritsLoose(e,o);var t=e.prototype;return t.shouldComponentUpdate=function(e,t){return this.state.queue!==t.queue},t.componentWillUnmount=function(){this.state.queue.forEach(function(e){URL.createObjectURL(e)})},t.render=function(){return React__default.createElement(React__default.Fragment,null,React__default.createElement(Dropzone,{onDrop:this.filesFromClient},function(e){var t=e.getRootProps,r=e.getInputProps;return React__default.createElement("section",{className:"file-upload-dropzone"},React__default.createElement("div",t(),React__default.createElement("input",r()),React__default.createElement("button",{type:"button",className:"btn btn-primary"},"select files...")))}),this.displayFiles())},e}(React__default.Component);DropZone.propTypes={input:PropTypes.oneOfType([PropTypes.object]),placeholder:PropTypes.string,endPoint:PropTypes.shape({path:PropTypes.string.isRequired,headers:PropTypes.shape({})}).isRequired,formControl:PropTypes.string,computedInvalid:PropTypes.bool.isRequired},DropZone.defaultProps={input:{},placeholder:null,formControl:null};var DropZone$1=Context(Context$1(DropZone)),Password=function(e){var t=e.input,r=e.placeholder,o=e.formControl,a=e.computedInvalid;return React__default.createElement("input",_extends({type:"password",placeholder:r,className:classNames("ffc-input",{"is-invalid":a},o)},t))};Password.propTypes={input:PropTypes.oneOfType([PropTypes.object]),placeholder:PropTypes.string,formControl:PropTypes.string,computedInvalid:PropTypes.bool.isRequired},Password.defaultProps={input:{},placeholder:null,formControl:null};var Password$1=Context(Context$1(Password)),Radio=function(e){var o=e.input,t=e.children,r=e.formControl,a=e.computedInvalid,n=Array.isArray(t)?t:[t],s=n.map(function(t,e){return React__default.createElement("div",{className:"form-check",key:t.props.value},React__default.createElement("input",{type:"radio",name:""+o.name,id:o.name+"_"+e,value:t.props.value,className:classNames("form-check-label"),onChange:function(e){return function(e,t,r){o.onChange(r.props.value)}(0,0,t)},checked:String(o.value)===String(t.props.value)})," ",React__default.createElement("label",{htmlFor:o.name+"_"+e,className:classNames("form-check-label")},t.props.children))});return React__default.createElement("div",{className:classNames("ffc-input",{"is-invalid":a},r)},s)};Radio.propTypes={input:PropTypes.oneOfType([PropTypes.object]),children:PropTypes.oneOfType([PropTypes.object,PropTypes.array]).isRequired,formControl:PropTypes.string,computedInvalid:PropTypes.bool.isRequired},Radio.defaultProps={input:{},formControl:null};var Radio$1=Context(Context$1(Radio)),Select=function(e){var r=e.input,t=e.children,o=e.placeholder,a=e.formControl,n=e.computedInvalid,s=(r.value,_objectWithoutPropertiesLoose(r,["value"])),i=(Array.isArray(t)?t:[t]).map(function(e,t){return React__default.createElement("option",{key:t,value:e.props.value,selected:String(r.value)===String(e.props.value)},e.props.children)});return React__default.createElement("select",_extends({placeholder:o,className:classNames("ffc-input",{"is-invalid":n},a)},s),i)};Select.propTypes={input:PropTypes.oneOfType([PropTypes.object]),children:PropTypes.oneOfType([PropTypes.object,PropTypes.array]).isRequired,placeholder:PropTypes.string,formControl:PropTypes.string,computedInvalid:PropTypes.bool.isRequired},Select.defaultProps={input:{},placeholder:null,formControl:null};var Select$1=Context(Context$1(Select)),Text=function(e){var t=e.input,r=e.placeholder,o=e.formControl,a=e.computedInvalid;return React__default.createElement("input",_extends({type:"text",placeholder:r,className:classNames("ffc-input",{"is-invalid":a},o)},t))};Text.propTypes={input:PropTypes.oneOfType([PropTypes.object]),placeholder:PropTypes.string,formControl:PropTypes.string,computedInvalid:PropTypes.bool.isRequired},Text.defaultProps={input:{},placeholder:null,formControl:null};var Text$1=Context(Context$1(Text)),Textarea=function(e){var t=e.input,r=e.placeholder,o=e.formControl,a=e.computedInvalid,n=e.rows,s=(t.value,_objectWithoutPropertiesLoose(t,["value"]));return React__default.createElement("textarea",_extends({placeholder:r,className:classNames("ffc-input",{"is-invalid":a},o),rows:n},s))};Textarea.propTypes={input:PropTypes.oneOfType([PropTypes.object]),placeholder:PropTypes.string,formControl:PropTypes.string,computedInvalid:PropTypes.bool.isRequired,rows:PropTypes.number},Textarea.defaultProps={input:{},placeholder:null,formControl:null,rows:10};var Textarea$1=Context(Context$1(Textarea));exports.Checkbox=Checkbox$1,exports.Condition=Condition$1,exports.DropZone=DropZone$1,exports.Form=Form,exports.Password=Password$1,exports.Radio=Radio$1,exports.Select=Select$1,exports.Text=Text$1,exports.Textarea=Textarea$1;
